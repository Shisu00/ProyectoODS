{% extends 'base.html' %}

{% block title %}Detalle del Producto - {{ producto.nombre }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row">
    <div class="col-md-6">
      {% if producto.imagen %}
        <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" class="img-fluid rounded">
      {% else %}
        <div class="bg-light d-flex align-items-center justify-content-center" style="height: 300px;">
          <i class="bi bi-image text-muted" style="font-size: 5rem;"></i>
        </div>
      {% endif %}
    </div>
    <div class="col-md-6">
      <h2>{{ producto.nombre }}</h2>
      <p>{{ producto.descripcion|default:"Sin descripción." }}</p>
      <p><strong>Categoría:</strong> {{ producto.id_categoria.nombre_categoria|default:"Sin categoría" }}</p>
      <p><strong>Cantidad:</strong> {{ producto.cantidad }} {{ producto.get_unidad_medida_display }}</p>
      <p><strong>Fecha de Publicación:</strong> {{ producto.fecha_publicacion|date:"d/m/Y" }}</p>
      <p><strong>Fecha de Vencimiento:</strong> {{ producto.fecha_vencimiento|default:"No especificada" }}</p>
      <p><strong>Estado:</strong> {{ producto.get_estado_display }}</p>
      <p><strong>Proveedor:</strong> {{ producto.id_usuario.nombre }}</p>

      <div class="mt-4">
        <a href="{% url 'rescateComida:dashboard_cliente' %}" class="btn btn-secondary">Volver a Productos</a>
        <button class="btn btn-success agregar-carrito" 
        data-producto-id="{{ producto.id_producto }}"
        data-nombre="{{ producto.nombre }}">
          <i class="bi bi-cart-plus"></i> Agregar al Carrito
        </button>
      </div>
    </div>
  </div>
</div>

<form style="display:none;">
    {% csrf_token %}
</form>
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.agregar-carrito').forEach(btn => {
        btn.addEventListener('click', function() {
            const productoId = this.dataset.productoId;
            const cantidad = 1; 
            
            fetch('{% url "rescateComida:agregar_carrito" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify({
                    'producto_id': productoId,
                    'cantidad': cantidad
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`¡${this.dataset.nombre} agregado al carrito! (${data.total_items} items)`);
                }
            });
        });
    });
});
</script>
{% endblock %}


